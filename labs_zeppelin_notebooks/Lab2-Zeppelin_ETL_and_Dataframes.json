{"paragraphs":[{"text":"%md\nThe following sections loads a CSV file containing ariport information and transforms it into a dataframe which can be queried using sql. Some operations have been commented but can be enabled to see what happens. ","user":"anonymous","dateUpdated":"2017-02-08T09:27:11+0100","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"results":[{"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207825_1076205465","id":"20160422-085839_1825994819","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:12+0100","dateFinished":"2017-02-08T09:27:12+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:6025"},{"text":"case class Airport(name:String, city:String, country:String, code :String, ICAO : String, lat:Double, lan:Double, altitude : Float,\nutc_offset : Float, DST : String, timezone : String)\n\nval airports = sc.textFile(\"/mapr/training.mapr.com/data/lab2_dataset/airports.csv\")\n    .map(_.replaceAll(\"\\\"\",\"\"))\n    .map(_.split(\",\"))\n    .map(a => Airport(a(1), a(2), a(3), a(4), a(5), a(6).toDouble ,a(7).toDouble, a(8).toFloat, a(9).toFloat, a(10), a(11)))\n//    .map(airport => airport.copy(altitude = airport.altitude/3.2808399f)) // change altitude to feet instead of meters\n//    .filter(_.country == \"Netherlands\") // only keep airports in the Netherlands\n//    .cache // cache this result so that it does not have to be recalculated later on\nprintln(\"total number of airports in data: \"+airports.count)\n\nval airportsDF = airports.toDF // create dataframe from RDD (enabling SQL functions on it)\nairportsDF.show // show top 20 rows\nairportsDF.registerTempTable(\"airports\") // register the dataframe so it can be referenced from the SQL contex\nsqlContext.sql(\"SELECT * FROM airports WHERE country='United States' OR country='Virgin Islands' OR country='Puerto Rico'\").registerTempTable(\"us_airports\")\n","user":"anonymous","dateUpdated":"2017-02-08T09:27:11+0100","config":{"tableHide":false,"editorMode":"ace/mode/scala","colWidth":12,"editorHide":false,"results":[{"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}}}],"enabled":true,"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207827_1076974963","id":"20160422-085839_1136840383","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:12+0100","dateFinished":"2017-02-08T09:27:23+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6026"},{"text":"%md\nThe airport RDD is used to figure out the number of airports per country (could be done using sql as well). With some slight modifications it is also possible to figure out the number of airports per timezone and their average altitude...","user":"anonymous","dateUpdated":"2017-02-08T09:27:12+0100","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"enabled":true,"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}},"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207828_1075051218","id":"20160422-085839_967685739","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:13+0100","dateFinished":"2017-02-08T09:27:13+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6027"},{"text":"val airportsPerCountry = airports\n    .coalesce(1) // repartition into one partition\n    .map(airport => (airport.country, 1)) // create tuple with country as key and 1 for each airport\n    .reduceByKey(_+_, 2) // shuffle data into two partitions\n    .map(tuple => (tuple._2, tuple._1))\n    .sortByKey(false, 4) // sort data on key (desc) into 4 paritions\n\n\nprintln(\"Number of partitions: \"+airportsPerCountry.partitions.size) // show the number of partitions\nairportsPerCountry.take(10).foreach(println) // prints top 10 countries by number of airports","user":"anonymous","dateUpdated":"2017-02-08T09:27:12+0100","config":{"tableHide":false,"editorMode":"ace/mode/scala","colWidth":12,"editorHide":false,"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207828_1075051218","id":"20160422-085839_590701372","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:13+0100","dateFinished":"2017-02-08T09:27:29+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6028"},{"text":"%md\nSome nice SQL on the registered airports table. Try other queries and visualisations!","user":"anonymous","dateUpdated":"2017-02-08T09:27:13+0100","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"enabled":true,"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}},"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207828_1075051218","id":"20160422-085839_1080767346","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:14+0100","dateFinished":"2017-02-08T09:27:14+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6029"},{"text":"%sql\nselect country, count(1) cnt, avg(altitude) avg_alt from airports group by country having avg_alt > ${minAltitude=1000} order by avg_alt desc","user":"anonymous","dateUpdated":"2017-02-08T09:27:14+0100","config":{"lineNumbers":false,"tableHide":false,"editorMode":"ace/mode/sql","colWidth":12,"editorHide":false,"graph":{"keys":[{"index":0,"name":"country","aggr":"sum"}],"optionOpen":false,"height":300,"lineWithFocus":false,"values":[{"index":2,"name":"avg_alt","aggr":"sum"}],"mode":"multiBarChart","groups":[],"scatter":{"xAxis":{"index":0,"name":"country","aggr":"sum"}}},"enabled":true,"results":{},"editorSetting":{"language":"sql"}},"settings":{"params":{"minAltitude":"1000","minCount":"100000","minAltitudeM":"500"},"forms":{"minAltitude":{"name":"minAltitude","defaultValue":"1000","hidden":false,"$$hashKey":"object:6424"}}},"apps":[],"jobName":"paragraph_1486542207830_1075820716","id":"20160422-085839_361343734","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:24+0100","dateFinished":"2017-02-08T09:27:37+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6030"},{"text":"%md\nThe following block reads a Parquet file containing all the flights within the United States in 2008 and registers it with the SQLContext","user":"anonymous","dateUpdated":"2017-02-08T09:27:14+0100","config":{"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"enabled":true,"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}},"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207830_1075820716","id":"20160422-085839_1094928578","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:15+0100","dateFinished":"2017-02-08T09:27:15+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6031"},{"text":"val flights_large = sqlContext.read.parquet(\"/mapr/training.mapr.com/data/lab2_dataset/flights_2008_sample.parquet\") // read parquet file\nval toBool = udf[Boolean, Int](_ == 1) // define a 'user defined function' converting integer value to boolean\n\nval flights = flights_large.select(\"Month\", \"DayofMonth\", \"DayOfWeek\",\"DepTime\",\"ArrTime\",\"UniqueCarrier\",\"FlightNum\",\"ActualElapsedTime\", \"ArrDelay\", \"DepDelay\", \"Origin\", \"Dest\", \"Distance\", \"Cancelled\").withColumn(\"Cancelled\", toBool(flights_large(\"Cancelled\"))) // select a number of columns and use the UDF to convert the 'cancelled' column from int to boolean\n\nflights.registerTempTable(\"flights\")\nflights.show\nprint(\"Number of flights: \"+flights.count)","user":"anonymous","dateUpdated":"2017-02-08T09:27:15+0100","config":{"tableHide":false,"editorMode":"ace/mode/scala","colWidth":12,"editorHide":false,"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207831_1075435967","id":"20160422-085839_1231548245","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:30+0100","dateFinished":"2017-02-08T09:27:48+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6032"},{"text":"%md \nTry out some queries yourself. It is possible to change the scrips above, re-run them and change the outcome of your queries.","user":"anonymous","dateUpdated":"2017-02-08T09:27:15+0100","config":{"tableHide":false,"editorMode":"ace/mode/markdown","colWidth":12,"editorHide":true,"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}},"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207831_1075435967","id":"20160422-085839_1343141288","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:27:16+0100","dateFinished":"2017-02-08T09:27:16+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6033"},{"text":"%sql\nselect UniqueCarrier, avg(DepDelay) as avg_dep, avg(ArrDelay) avg_arr, count(1) count \nfrom flights, us_airports \nwhere flights.Origin = us_airports.code \ngroup by UniqueCarrier ","user":"anonymous","dateUpdated":"2017-02-08T09:28:19+0100","config":{"tableHide":false,"editorMode":"ace/mode/sql","colWidth":12,"editorHide":false,"graph":{"keys":[{"index":0,"name":"UniqueCarrier","aggr":"sum"}],"optionOpen":true,"height":300,"values":[{"index":1,"name":"avg_dep","aggr":"sum"}],"mode":"scatterChart","groups":[],"scatter":{"yAxis":{"index":2,"name":"avg_arr","aggr":"sum"},"group":{"index":0,"name":"UniqueCarrier","aggr":"sum"},"xAxis":{"index":1,"name":"avg_dep","aggr":"sum"},"size":{"index":3,"name":"count","aggr":"sum"}}},"enabled":true,"results":{},"editorSetting":{"language":"sql"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207831_1075435967","id":"20160422-085839_134769477","dateCreated":"2017-02-08T09:23:27+0100","dateStarted":"2017-02-08T09:28:19+0100","dateFinished":"2017-02-08T09:28:28+0100","status":"FINISHED","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6034"},{"user":"anonymous","dateUpdated":"2017-02-08T09:27:16+0100","config":{"editorMode":"ace/mode/scala","colWidth":12,"editorHide":false,"enabled":true,"graph":{"keys":[],"optionOpen":false,"height":300,"values":[],"mode":"table","groups":[],"scatter":{}},"results":{},"editorSetting":{"language":"scala"}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1486542207832_1073512223","id":"20160422-085839_1398159326","dateCreated":"2017-02-08T09:23:27+0100","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:6035"}],"name":"Lab2 - ETL & Dataframes","id":"2CB6TUUS7","angularObjects":{"2C7PJ76G4:shared_process":[],"2CAKWEBCP:shared_process":[],"2CAJAE8FS:shared_process":[],"2C9SC22ZA:shared_process":[],"2C7E3YURT:shared_process":[],"2C9QEFEVM:shared_process":[],"2CB9E937H:shared_process":[],"2C89F1UUR:shared_process":[],"2CAG461GR:shared_process":[],"2C8WQGZ95:shared_process":[],"2C91QSZPZ:shared_process":[],"2CAQS2NZ9:shared_process":[],"2CA9R2P6W:shared_process":[],"2C97ZPDRJ:shared_process":[],"2CAKDRNUP:shared_process":[],"2C8R5WJKF:shared_process":[],"2C9DB7ZX9:shared_process":[],"2CAW7T5ZV:shared_process":[],"2C9KSWREA:shared_process":[]},"config":{"looknfeel":"default","personalizedMode":"false"},"info":{}}