{"paragraphs":[{"text":"%md\nThe following sections loads a CSV file containing ariport information and transforms it into a dataframe which can be queried using sql. Some operations have been commented but can be enabled to see what happens. ","authenticationInfo":{},"dateUpdated":"Oct 11, 2016 11:00:28 AM","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919516_-1045722751","id":"20160422-085839_1825994819","result":{"code":"SUCCESS","type":"HTML","msg":"<p>The following sections loads a CSV file containing ariport information and transforms it into a dataframe which can be queried using sql. Some operations have been commented but can be enabled to see what happens.</p>\n"},"dateCreated":"Apr 22, 2016 8:58:39 AM","dateStarted":"Oct 11, 2016 11:00:28 AM","dateFinished":"Oct 11, 2016 11:00:28 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:943"},{"text":"case class Airport(name:String, city:String, country:String, code :String, ICAO : String, lat:Double, lan:Double, altitude : Float,\nutc_offset : Float, DST : String, timezone : String)\n\nval airports = sc.textFile(\"/mapr/training.mapr.com/data/lab2_dataset/airports.csv\")\n    .map(_.replaceAll(\"\\\"\",\"\"))\n    .map(_.split(\",\"))\n    .map(a => Airport(a(1), a(2), a(3), a(4), a(5), a(6).toDouble ,a(7).toDouble, a(8).toFloat, a(9).toFloat, a(10), a(11)))\n//    .map(airport => airport.copy(altitude = airport.altitude/3.2808399f)) // change altitude to feet instead of meters\n//    .filter(_.country == \"Netherlands\") // only keep airports in the Netherlands\n//    .cache // cache this result so that it does not have to be recalculated later on\nprintln(\"total number of airports in data: \"+airports.count)\n\nval airportsDF = airports.toDF // create dataframe from RDD (enabling SQL functions on it)\nairportsDF.show // show top 20 rows\nairportsDF.registerTempTable(\"airports\") // register the dataframe so it can be referenced from the SQL contex\nsqlContext.sql(\"SELECT * FROM airports WHERE country='United States' OR country='Virgin Islands' OR country='Puerto Rico'\").registerTempTable(\"us_airports\")\n","authenticationInfo":{},"dateUpdated":"Oct 11, 2016 11:06:37 AM","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919518_-1044953254","id":"20160422-085839_1136840383","result":{"code":"SUCCESS","type":"TEXT","msg":"defined class Airport\nairports: org.apache.spark.rdd.RDD[Airport] = MapPartitionsRDD[151] at map at <console>:29\ntotal number of airports in data: 8107\nairportsDF: org.apache.spark.sql.DataFrame = [name: string, city: string, country: string, code: string, ICAO: string, lat: double, lan: double, altitude: float, utc_offset: float, DST: string, timezone: string]\n+--------------------+--------------+----------------+----+----+---------+----------+--------+----------+---+--------------------+\n|                name|          city|         country|code|ICAO|      lat|       lan|altitude|utc_offset|DST|            timezone|\n+--------------------+--------------+----------------+----+----+---------+----------+--------+----------+---+--------------------+\n|              Goroka|        Goroka|Papua New Guinea| GKA|AYGA|-6.081689|145.391881|  5282.0|      10.0|  U|Pacific/Port_Moresby|\n|              Madang|        Madang|Papua New Guinea| MAG|AYMD|-5.207083|  145.7887|    20.0|      10.0|  U|Pacific/Port_Moresby|\n|         Mount Hagen|   Mount Hagen|Papua New Guinea| HGU|AYMH|-5.826789|144.295861|  5388.0|      10.0|  U|Pacific/Port_Moresby|\n|              Nadzab|        Nadzab|Papua New Guinea| LAE|AYNZ|-6.569828|146.726242|   239.0|      10.0|  U|Pacific/Port_Moresby|\n|Port Moresby Jack...|  Port Moresby|Papua New Guinea| POM|AYPY|-9.443383| 147.22005|   146.0|      10.0|  U|Pacific/Port_Moresby|\n|          Wewak Intl|         Wewak|Papua New Guinea| WWK|AYWK|-3.583828|143.669186|    19.0|      10.0|  U|Pacific/Port_Moresby|\n|          Narsarsuaq|  Narssarssuaq|       Greenland| UAK|BGBW|61.160517|-45.425978|   112.0|      -3.0|  E|     America/Godthab|\n|                Nuuk|      Godthaab|       Greenland| GOH|BGGH|64.190922|-51.678064|   283.0|      -3.0|  E|     America/Godthab|\n|   Sondre Stromfjord|   Sondrestrom|       Greenland| SFJ|BGSF|67.016969|-50.689325|   165.0|      -3.0|  E|     America/Godthab|\n|      Thule Air Base|         Thule|       Greenland| THU|BGTL|76.531203|-68.703161|   251.0|      -4.0|  E|       America/Thule|\n|            Akureyri|      Akureyri|         Iceland| AEY|BIAR|65.659994|-18.072703|     6.0|       0.0|  N|  Atlantic/Reykjavik|\n|         Egilsstadir|   Egilsstadir|         Iceland| EGS|BIEG|65.283333|-14.401389|    76.0|       0.0|  N|  Atlantic/Reykjavik|\n|        Hornafjordur|          Hofn|         Iceland| HFN|BIHN|64.295556|-15.227222|    24.0|       0.0|  N|  Atlantic/Reykjavik|\n|             Husavik|       Husavik|         Iceland| HZK|BIHU|65.952328|-17.425978|    48.0|       0.0|  N|  Atlantic/Reykjavik|\n|          Isafjordur|    Isafjordur|         Iceland| IFJ|BIIS|66.058056|-23.135278|     8.0|       0.0|  N|  Atlantic/Reykjavik|\n|Keflavik Internat...|      Keflavik|         Iceland| KEF|BIKF|   63.985|-22.605556|   171.0|       0.0|  N|  Atlantic/Reykjavik|\n|      Patreksfjordur|Patreksfjordur|         Iceland| PFJ|BIPA|65.555833|   -23.965|    11.0|       0.0|  N|  Atlantic/Reykjavik|\n|           Reykjavik|     Reykjavik|         Iceland| RKV|BIRK|    64.13|-21.940556|    48.0|       0.0|  N|  Atlantic/Reykjavik|\n|        Siglufjordur|  Siglufjordur|         Iceland| SIJ|BISI|66.133333|-18.916667|    10.0|       0.0|  N|  Atlantic/Reykjavik|\n|      Vestmannaeyjar|Vestmannaeyjar|         Iceland| VEY|BIVM|63.424303|-20.278875|   326.0|       0.0|  N|  Atlantic/Reykjavik|\n+--------------------+--------------+----------------+----+----+---------+----------+--------+----------+---+--------------------+\nonly showing top 20 rows\n\n"},"dateCreated":"Apr 22, 2016 8:58:39 AM","dateStarted":"Oct 11, 2016 11:06:37 AM","dateFinished":"Oct 11, 2016 11:06:38 AM","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:944"},{"text":"%md\nThe airport RDD is used to figure out the number of airports per country (could be done using sql as well). With some slight modifications it is also possible to figure out the number of airports per timezone and their average altitude...","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919518_-1044953254","id":"20160422-085839_967685739","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:945"},{"text":"val airportsPerCountry = airports\n    .coalesce(1) // repartition into one partition\n    .map(airport => (airport.country, 1)) // create tuple with country as key and 1 for each airport\n    .reduceByKey(_+_, 2) // shuffle data into two partitions\n    .map(tuple => (tuple._2, tuple._1))\n    .sortByKey(false, 4) // sort data on key (desc) into 4 paritions\n\n\nprintln(\"Number of partitions: \"+airportsPerCountry.partitions.size) // show the number of partitions\nairportsPerCountry.take(10).foreach(println) // prints top 10 countries by number of airports","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919519_-1045338002","id":"20160422-085839_590701372","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:946"},{"text":"%md\nSome nice SQL on the registered airports table. Try other queries and visualisations!","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919519_-1045338002","id":"20160422-085839_1080767346","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:947"},{"text":"%sql\nselect country, count(1) cnt, avg(altitude) avg_alt from airports group by country having avg_alt > ${minAltitude=1000} order by avg_alt desc","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"lineNumbers":false,"tableHide":false,"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"graph":{"mode":"multiBarChart","height":300,"optionOpen":false,"keys":[{"name":"country","index":0,"aggr":"sum"}],"values":[{"name":"avg_alt","index":2,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"country","index":0,"aggr":"sum"}},"lineWithFocus":false},"enabled":true},"settings":{"params":{"minAltitude":"1000","minCount":"100000","minAltitudeM":"500"},"forms":{"minAltitude":{"name":"minAltitude","defaultValue":"1000","hidden":false}}},"jobName":"paragraph_1461311919519_-1045338002","id":"20160422-085839_361343734","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:948"},{"text":"%md\nThe following block reads a Parquet file containing all the flights within the United States in 2008 and registers it with the SQLContext","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919520_-1059573712","id":"20160422-085839_1094928578","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:949"},{"text":"val flights_large = sqlContext.read.parquet(\"/mapr/training.mapr.com/data/lab2_dataset/flights_2008_sample.parquet\") // read parquet file\nval toBool = udf[Boolean, Int](_ == 1) // define a 'user defined function' converting integer value to boolean\n\nval flights = flights_large.select(\"Month\", \"DayofMonth\", \"DayOfWeek\",\"DepTime\",\"ArrTime\",\"UniqueCarrier\",\"FlightNum\",\"ActualElapsedTime\", \"ArrDelay\", \"DepDelay\", \"Origin\", \"Dest\", \"Distance\", \"Cancelled\").withColumn(\"Cancelled\", toBool(flights_large(\"Cancelled\"))) // select a number of columns and use the UDF to convert the 'cancelled' column from int to boolean\n\nflights.registerTempTable(\"flights\")\nflights.show\nprint(\"Number of flights: \"+flights.count)","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919520_-1059573712","id":"20160422-085839_1231548245","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:950"},{"text":"%md \nTry out some queries yourself. It is possible to change the scrips above, re-run them and change the outcome of your queries.","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/markdown","editorHide":true,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919520_-1059573712","id":"20160422-085839_1343141288","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:951"},{"text":"%sql\nselect UniqueCarrier, avg(DepDelay) as avg_dep, avg(ArrDelay) avg_arr, count(1) count \nfrom flights, us_airports \nwhere flights.Origin = us_airports.code \ngroup by UniqueCarrier ","dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"tableHide":false,"colWidth":12,"editorMode":"ace/mode/sql","editorHide":false,"graph":{"mode":"scatterChart","height":300,"optionOpen":true,"keys":[{"name":"UniqueCarrier","index":0,"aggr":"sum"}],"values":[{"name":"avg_dep","index":1,"aggr":"sum"}],"groups":[],"scatter":{"xAxis":{"name":"avg_dep","index":1,"aggr":"sum"},"group":{"name":"UniqueCarrier","index":0,"aggr":"sum"},"size":{"name":"count","index":3,"aggr":"sum"},"yAxis":{"name":"avg_arr","index":2,"aggr":"sum"}}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919521_-1059958461","id":"20160422-085839_134769477","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:952"},{"dateUpdated":"Apr 22, 2016 8:58:39 AM","config":{"colWidth":12,"editorMode":"ace/mode/scala","editorHide":false,"graph":{"mode":"table","height":300,"optionOpen":false,"keys":[],"values":[],"groups":[],"scatter":{}},"enabled":true},"settings":{"params":{},"forms":{}},"jobName":"paragraph_1461311919521_-1059958461","id":"20160422-085839_1398159326","dateCreated":"Apr 22, 2016 8:58:39 AM","status":"READY","errorMessage":"","progressUpdateIntervalMs":500,"$$hashKey":"object:953"}],"name":"Lab2 - ETL & Dataframes","id":"2BHNZ8D5Y","angularObjects":{"2BGRRSV66":[],"2BJ2VWKJZ":[],"2BFM4ET3V":[],"2BFQ9NYBH":[],"2BH65YMH4":[],"2BFUX85C9":[],"2BHRRR9VJ":[],"2BK1CVPS1":[],"2BJKHN9KF":[],"2BG4RAZ3U":[],"2BHHWQV58":[],"2BGY19DBS":[],"2BJH5FGAQ":[],"2BH7QS7U7":[],"2BHCTUXCJ":[],"2BHK7YRH1":[],"2BG1YRXN9":[]},"config":{"looknfeel":"default"},"info":{}}
